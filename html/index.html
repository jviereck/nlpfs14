 <!DOCTYPE html>
<html>
  <head>
 	  <script src="zepto.js"></script>
    <meta charset="UTF-8">
    <title>NLP Analysis Tool</title>
  </head>
  <body>
    <h3>Models</h3>
    <div id="models"></div>
    <h3>Corefs</h3>
    <div id="coref"></div>
    <div id="text"></div>
<script>
  var files = [];
  var currentFileIdx = -1;
  var data = {};
  var corefs = [];
  var sentences = [];

  function setHTML(id, content) {
    document.getElementById(id).innerHTML = content;
  }

  function table(str) {
    return '<table>' + str + '</table>';
  }

  function tr(str) {
    return '<tr>' + str + '</tr>';
  }

  function td(str) {
    return '<td>' + str + '</td>';
  }

  function li(str) {
    return '<li>' + str + '</li>';
  }

  function ul(str) {
    return '<ul>' + str + '</ul>';
  }

  function strong(str) {
    return '<strong>' + str + '</strong>';
  }

  function parseCorefs(data) {
    corefs = data.coref.map(function(entries) {
      var obj = {
        representive: entries[0][1][0],
        refs: []
      }
      function addRef(subEntry) {
        obj.refs.push({
          text: subEntry[0],
          sentence: subEntry[1],
          head: subEntry[2],
          start: subEntry[3],
          end: subEntry[4]
        });
      }

      // Add the representive itself to the references.
      addRef(entries[0][1]);

      // Add the other coreferences to the references as well.
      entries.forEach(function(entry) {
        addRef(entry[0]);
      })
      return obj;
    }).sort(function(a, b) {
      return b.refs.length - a.refs.length;
    });
  }

  function parseData(data) {
    parseCorefs(data.parse);
  }

  function updateUI() {
    function mapCoref(coref) {
      var rep = coref.refs[0];
      var headWord = sentences[rep.sentence].words[rep.head];

      return tr(
        td(coref.refs.length) +
        td(strong(coref.representive)) +
        td(headWord[1].NamedEntityTag + '/' + headWord[1].PartOfSpeech)
      )
    }

    setHTML('models', ul(data.models.map(li).join('')));
    setHTML('coref', table(corefs.map(mapCoref).join('')));


  }

  function showNext() {
    currentFileIdx += 1;
    $.getJSON(files[currentFileIdx], function(json) {
      data = json;
      sentences = data.parse.sentences;

      parseData(data);
      updateUI();
    });
  }

  $.get('filelist.txt', function(data) {
    files = data.split('\n').map(function(str) {
      return str.substring(4).replace('.', '_') + '.json';
    });

    showNext();
  })
</script>


  </body>
</html>
